# Путь борьбы с проблемой дисбаланса в CNN+LSTM моделях

## Проблема
Модель CNN+LSTM показывает систематическую предвзятость в предсказаниях направления движения цен: точность для одного направления (падения) составляет 1.000, а для другого направления (роста) - 0.000, несмотря на 52% общей Directional Accuracy.

## Хронология подходов к решению проблемы

### 1. Базовая модель (файл: `cnn_lstm/reduced_cnn_lstm_integration.py`)
- **Подход**: Использование стандартной функции потерь с акцентом на Directional Accuracy
- **Результат**: Точность для роста 0.000, точность для падения 1.000
- **Вывод**: Модель предсказывает только одно направление

### 2. Добавление шума (файл: `cnn_lstm/noise_balanced_cnn_lstm_integration.py`)
- **Подход**: Добавление шума к выходу модели во время обучения
- **Результат**: Точность для роста 0.000, точность для падения 1.000
- **Вывод**: Добавление шума не решило проблему систематического предсказания одного направления

### 3. Динамическое взвешивание (файл: `cnn_lstm/dynamic_weighted_cnn_lstm_integration.py`)
- **Подход**: Использование динамических весов, изменяющихся на основе распределения направлений
- **Результат**: Веса не изменялись (оставались 1.000 для обоих направлений), модель по-прежнему предсказывала только падение
- **Вывод**: Динамическое взвешивание без изменения архитектуры неэффективно

### 4. Класс-балансированная функция потерь (файл: `cnn_lstm/balanced_da_cnn_lstm_integration.py`)
- **Подход**: Использование функции потерь с балансировкой на основе эффективных количеств классов
- **Формула**: effective_n = (1 - β) / (1 - β^n) (неправильная)
- **Результат**: Точность для роста 0.000, точность для падения 1.000
- **Вывод**: Неправильная формула вычисления эффективных количеств не решила проблему

### 5. Исправленная формула эффективных количеств (файл: `cnn_lstm/fixed_balanced_cnn_lstm_integration.py`)
- **Подход**: Использование корректной формулы для вычисления эффективных количеств
- **Формула**: effective_n = (1 - β^n) / (1 - β) (правильная)
- **Результат**: Точность для роста 0.000, точность для падения 1.000
- **Вывод**: Даже с правильной формулой проблема сохраняется

## Заключение
Проблема дисбаланса в предсказаниях CNN+LSTM моделей не решается только изменением функции потерь. Все попытки балансировки (через взвешивание, добавление шума, динамическую настройку весов) не дали результата. Это указывает на более глубокую проблему в архитектуре модели или процессе обучения, требующую комплексного подхода:

1. **Изменение архитектуры модели**
2. **Аугментация данных**
3. **Калибровка модели**
4. **Использование ансамблей**
5. **Модификация процесса обучения**
